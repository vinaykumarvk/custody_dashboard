<!-- Open Events Template -->
<div class="container-fluid" ng-controller="OpenEventsController">
    <div class="row">
        <div class="col-12">
            <div class="page-header">
                <h1>Open Events</h1>
                <p class="text-muted">Event tracking and resolution management</p>
            </div>
        </div>
    </div>
    
    <!-- Events Metrics -->
    <div class="row metrics-row">
        <div class="col-md-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-icon">
                        <i class="fa fa-exclamation-circle"></i>
                    </div>
                    <div class="metric-content">
                        <h5 class="metric-title">Open Events</h5>
                        <h2 class="metric-value">{{ openEvents }}</h2>
                        <div class="metric-trend trend-down">
                            <i class="fa fa-arrow-down"></i>
                            <span>12.5%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-icon">
                        <i class="fa fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-content">
                        <h5 class="metric-title">Critical Events</h5>
                        <h2 class="metric-value">{{ criticalEvents }}</h2>
                        <div class="metric-trend trend-down">
                            <i class="fa fa-arrow-down"></i>
                            <span>20.0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-icon">
                        <i class="fa fa-wallet"></i>
                    </div>
                    <div class="metric-content">
                        <h5 class="metric-title">Open Entitlements</h5>
                        <h2 class="metric-value">{{ formatNumber(openEntitlements) }}</h2>
                        <div class="metric-trend trend-up">
                            <i class="fa fa-arrow-up"></i>
                            <span>2.3%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card metric-card">
                <div class="card-body">
                    <div class="metric-icon">
                        <i class="fa fa-hourglass-half"></i>
                    </div>
                    <div class="metric-content">
                        <h5 class="metric-title">Avg Event Age</h5>
                        <h2 class="metric-value">{{ avgEventAge }} days</h2>
                        <div class="metric-trend trend-up">
                            <i class="fa fa-arrow-up"></i>
                            <span>5.9%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Section -->
    <div class="row">
        <!-- Events by Category -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Events by Category</h5>
                </div>
                <div class="card-body">
                    <canvas id="eventsByCategoryChart" class="chart-container"
                            chart-data="eventsByCategoryData"
                            chart-labels="categoryLabels"
                            chart-options="pieChartOptions"
                            chart-type="pie"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Event Aging -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Event Aging</h5>
                </div>
                <div class="card-body">
                    <canvas id="eventAgingChart" class="chart-container"
                            chart-data="eventAgingData"
                            chart-labels="agingLabels"
                            chart-options="barChartOptions"
                            chart-type="bar"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Event Priority Distribution -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Event Priority Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="eventPriorityChart" class="chart-container"
                            chart-data="eventPriorityData"
                            chart-labels="priorityLabels"
                            chart-options="horizontalBarOptions"
                            chart-type="horizontalBar"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Monthly Event Trend -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Monthly Event Trend</h5>
                </div>
                <div class="card-body">
                    <canvas id="monthlyEventsChart" class="chart-container"
                            chart-data="monthlyEventsData"
                            chart-labels="monthLabels"
                            chart-series="['New Events', 'Resolved Events']"
                            chart-options="lineChartOptions"
                            chart-type="line"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Event Resolution Stats -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Resolution Statistics</h5>
                </div>
                <div class="card-body">
                    <div class="resolution-stats">
                        <div class="resolution-header">
                            <h3 class="resolution-rate">{{ resolutionRate }}%</h3>
                            <div class="resolution-rate-label">Resolution Rate</div>
                            <div class="resolution-rate-change">
                                <i class="fa fa-arrow-up text-success"></i>
                                <span>{{ resolutionRateChange }}%</span>
                            </div>
                        </div>
                        <div class="resolution-details mt-4">
                            <div class="resolution-detail-item">
                                <div class="detail-label">Average Resolution Time</div>
                                <div class="detail-value">32 hours</div>
                                <div class="detail-change text-success">
                                    <i class="fa fa-arrow-down"></i>
                                    <span>4.2%</span>
                                </div>
                            </div>
                            <div class="resolution-detail-item mt-3">
                                <div class="detail-label">First Response Time</div>
                                <div class="detail-value">2.5 hours</div>
                                <div class="detail-change text-success">
                                    <i class="fa fa-arrow-down"></i>
                                    <span>12.4%</span>
                                </div>
                            </div>
                            <div class="resolution-detail-item mt-3">
                                <div class="detail-label">Critical Resolution Rate</div>
                                <div class="detail-value">95.8%</div>
                                <div class="detail-change text-success">
                                    <i class="fa fa-arrow-up"></i>
                                    <span>3.1%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Open Events Table -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>Open Events List</h5>
                    <div class="header-actions">
                        <div class="dropdown me-2 d-inline-block">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="eventCategoryFilter" data-bs-toggle="dropdown" aria-expanded="false">
                                All Categories
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="eventCategoryFilter">
                                <li><a class="dropdown-item" href="#">All Categories</a></li>
                                <li><a class="dropdown-item" href="#">Settlement</a></li>
                                <li><a class="dropdown-item" href="#">Corporate Action</a></li>
                                <li><a class="dropdown-item" href="#">Payment</a></li>
                                <li><a class="dropdown-item" href="#">Reconciliation</a></li>
                                <li><a class="dropdown-item" href="#">Data</a></li>
                            </ul>
                        </div>
                        <div class="input-group d-inline-flex" style="width: 250px;">
                            <input type="text" class="form-control" placeholder="Search events..." ng-model="eventSearch">
                            <div class="input-group-append">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Event ID</th>
                                    <th>Category</th>
                                    <th>Customer</th>
                                    <th>Created Date</th>
                                    <th>Age (days)</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="event in openEventsList">
                                    <td>{{ event.id }}</td>
                                    <td>{{ event.category }}</td>
                                    <td>{{ event.customer }}</td>
                                    <td>{{ formatDate(event.createdDate) }}</td>
                                    <td>{{ event.age }}</td>
                                    <td><span class="badge" ng-class="getStatusClass(event.status)">{{ event.status }}</span></td>
                                    <td><span ng-class="getPriorityClass(event.priority)">{{ event.priority }}</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary"><i class="fa fa-eye"></i></button>
                                        <button class="btn btn-sm btn-outline-info"><i class="fa fa-edit"></i></button>
                                        <button class="btn btn-sm btn-outline-success"><i class="fa fa-check"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <nav>
                        <ul class="pagination justify-content-end">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1">Previous</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Next</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Event Forecasts and Impact Section -->
    <div class="row">
        <div class="col-12">
            <div class="section-header">
                <h4>Event Forecasts & Impact Analysis</h4>
            </div>
        </div>
        
        <!-- Event Forecast -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Event Volume Forecast</h5>
                </div>
                <div class="card-body">
                    <canvas id="eventsForecastChart" class="chart-container"
                            chart-data="predictedEventsData"
                            chart-labels="predictionMonths"
                            chart-series="predictionYears"
                            chart-options="groupedBarOptions"
                            chart-type="bar"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Entitlements Prediction -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Expected Entitlements (in millions)</h5>
                </div>
                <div class="card-body">
                    <canvas id="entitlementsForecastChart" class="chart-container"
                            chart-data="expectedEntitlementsData"
                            chart-labels="predictionMonths"
                            chart-series="predictionYears"
                            chart-options="groupedBarOptions"
                            chart-type="bar"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Event Impact Analysis -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Events Impact Assessment</h5>
                </div>
                <div class="card-body">
                    <div class="impact-assessment">
                        <div class="impact-assessment-heading">
                            <div class="impact-heading-title">Current Business Impact</div>
                            <div class="impact-heading-level">Medium</div>
                        </div>
                        <div class="impact-areas mt-3">
                            <div class="impact-area">
                                <div class="impact-area-name">Customer Experience</div>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: 65%"></div>
                                </div>
                                <div class="impact-area-level">Medium (65%)</div>
                            </div>
                            <div class="impact-area mt-2">
                                <div class="impact-area-name">Operational Efficiency</div>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: 58%"></div>
                                </div>
                                <div class="impact-area-level">Medium (58%)</div>
                            </div>
                            <div class="impact-area mt-2">
                                <div class="impact-area-name">Financial Impact</div>
                                <div class="progress">
                                    <div class="progress-bar bg-info" style="width: 32%"></div>
                                </div>
                                <div class="impact-area-level">Low (32%)</div>
                            </div>
                            <div class="impact-area mt-2">
                                <div class="impact-area-name">Regulatory Compliance</div>
                                <div class="progress">
                                    <div class="progress-bar bg-danger" style="width: 78%"></div>
                                </div>
                                <div class="impact-area-level">High (78%)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5>Event Resolution Recommendations</h5>
                </div>
                <div class="card-body">
                    <div class="resolution-recommendations">
                        <div class="recommendation-item">
                            <div class="recommendation-icon">
                                <i class="fa fa-bolt text-danger"></i>
                            </div>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Critical Regulatory Events</div>
                                <div class="recommendation-desc">Prioritize resolution of 4 critical regulatory events within next 24 hours</div>
                                <div class="recommendation-impact">Impact: High - Compliance risk</div>
                            </div>
                        </div>
                        <div class="recommendation-item mt-3">
                            <div class="recommendation-icon">
                                <i class="fa fa-money-bill-wave text-warning"></i>
                            </div>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Settlement Delays (HDFC, Reliance)</div>
                                <div class="recommendation-desc">Process pending settlements for high-value transactions</div>
                                <div class="recommendation-impact">Impact: Medium - Client satisfaction</div>
                            </div>
                        </div>
                        <div class="recommendation-item mt-3">
                            <div class="recommendation-icon">
                                <i class="fa fa-database text-info"></i>
                            </div>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Data Reconciliation Events</div>
                                <div class="recommendation-desc">Batch process 3 data reconciliation events</div>
                                <div class="recommendation-impact">Impact: Low - Operational efficiency</div>
                            </div>
                        </div>
                        <div class="recommendation-item mt-3">
                            <div class="recommendation-icon">
                                <i class="fa fa-code-branch text-warning"></i>
                            </div>
                            <div class="recommendation-content">
                                <div class="recommendation-title">Corporate Action Processing</div>
                                <div class="recommendation-desc">Complete 2 pending corporate action events by EOD</div>
                                <div class="recommendation-impact">Impact: Medium - Customer experience</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .resolution-stats {
            padding: 10px;
        }
        
        .resolution-header {
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .resolution-rate {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0;
        }
        
        .resolution-rate-label {
            font-size: 1rem;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .resolution-rate-change {
            font-size: 0.9rem;
        }
        
        .resolution-detail-item {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 8px 0;
        }
        
        .detail-label {
            flex: 1;
            font-size: 0.9rem;
            color: var(--secondary-color);
        }
        
        .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 10px;
        }
        
        .detail-change {
            font-size: 0.8rem;
            width: 65px;
            text-align: right;
        }
        
        .impact-assessment-heading {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .impact-heading-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .impact-heading-level {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--warning-color);
        }
        
        .impact-area {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .impact-area-name {
            width: 180px;
            font-size: 0.9rem;
        }
        
        .impact-area .progress {
            flex: 1;
            margin: 0 10px;
            height: 8px;
        }
        
        .impact-area-level {
            width: 100px;
            font-size: 0.8rem;
            text-align: right;
        }
        
        .recommendation-item {
            display: flex;
            align-items: flex-start;
            padding: 0 5px;
        }
        
        .recommendation-icon {
            margin-right: 15px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #f8f9fc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .recommendation-content {
            flex: 1;
        }
        
        .recommendation-title {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .recommendation-desc {
            font-size: 0.9rem;
            color: var(--dark-color);
            margin-bottom: 3px;
        }
        
        .recommendation-impact {
            font-size: 0.8rem;
            color: var(--secondary-color);
            font-style: italic;
        }
    </style>
</div>